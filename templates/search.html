{% extends "base.html" %}

{% block title %}Search - WebMusic{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Search</h1>
</div>

<form method="GET" class="search-form">
    <input type="text" name="q" value="{{ query }}" placeholder="Search albums, artists, tracks..." class="search-input">
    <button type="submit">Search</button>
</form>

{% if query %}
<div class="search-results">
    {% if results.albums %}
    <section class="search-section">
        <h2>Albums ({{ results.albums|length }})</h2>
        <div class="search-albums">
            {% for album in results.albums %}
            <div class="search-album">
                <a href="{{ url_for('album_detail', album_id=album.id) }}">
                    <strong>{{ album.name }}</strong>
                    <span>by {{ album.artist or 'Unknown Artist' }}</span>
                </a>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    {% if results.tracks %}
    <section class="search-section">
        <h2>Tracks ({{ results.tracks|length }})</h2>
        <div class="search-tracks">
            {% for track in results.tracks %}
            <div class="search-track">
                <span class="track-title">{{ track.title }}</span>
                <span class="track-info">
                    by {{ track.artist or track.album_artist or 'Unknown Artist' }}
                    from {{ track.album_name }}
                </span>
                <button class="play-button" onclick="playTrack({{ track.id }}, '{{ track.title }}', '{{ track.artist or track.album_artist or 'Unknown Artist' }}')">â–¶</button>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    {% if not results.albums and not results.tracks %}
    <div class="empty-state">
        <p>No results found for "{{ query }}"</p>
    </div>
    {% endif %}
</div>
{% endif %}

<script>
function playTrack(trackId, title, artist) {
    const audio = document.getElementById('audio-player');
    const currentTrack = document.getElementById('current-track');
    
    audio.src = `/stream/${trackId}`;
    audio.play();
    
    currentTrack.textContent = `${artist} - ${title}`;
}
</script>
{% endblock %}
